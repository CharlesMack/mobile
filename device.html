<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0a160b" />
  <title>P.O.P.S. — Professional Production Mobile</title>
  <meta name="description" content="P.O.P.S. single-page interface with draggable, resizable app panels, AppDock, and AppDrop catalog." />
  <style>
    :root {
      --bg: radial-gradient(1200px 800px at 50% -10%, #1a1a1a 0%, #0e0e0e 40%, #0a0a0a 100%);
      --accent: #00ff7f; 
      --accent-light: #33ff99;
      --accent-dark: #00cc66;
      --accent-glow: rgba(0, 255, 127, 0.3);
      --muted: #9fe7c6;
      --glass: rgba(255, 255, 255, 0.08);
      --glass-border: rgba(255, 255, 255, 0.2);
      --shadow-glow: 0 0 40px var(--accent-glow);
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --dock-h: 68px; --status-h: 26px; --editbar-h: 34px;
    }
    
    * { box-sizing: border-box; }
    
    html, body {
      height: 100dvh;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg);
      color: #fff;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .bg-particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      width: 2px;
      height: 2px;
      background: var(--accent);
      border-radius: 50%;
      opacity: 0.6;
      animation: float 8s infinite ease-in-out;
      box-shadow: 0 0 6px var(--accent);
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.6; }
      50% { transform: translateY(-30px) rotate(180deg); opacity: 0.2; }
    }
    
    .phone {
      width: min(420px, 96vw);
      height: min(900px, 96dvh);
      border-radius: 32px;
      background: linear-gradient(145deg, rgba(21, 24, 21, 0.95), rgba(12, 18, 12, 0.95));
      border: 2px solid var(--accent-glow);
      box-shadow: 0 25px 80px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.2);
      overflow: hidden;
      position: relative;
      padding-bottom: var(--safe-bottom);
      backdrop-filter: blur(20px);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .phone::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: 30px;
      background: linear-gradient(45deg, transparent, var(--accent-glow), transparent);
      animation: shimmer 3s ease-in-out infinite;
    }
    
    @keyframes shimmer {
      0%, 100% { opacity: 0; transform: translateX(-100%); }
      50% { opacity: 1; transform: translateX(100%); }
    }
    
    .status {
      height: calc(var(--status-h) + var(--safe-top));
      padding: calc(var(--safe-top)) 16px 0 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.8), var(--accent-glow));
      border-bottom: 1px solid var(--accent-glow);
      backdrop-filter: blur(20px);
      z-index: 1000;
      position: relative;
    }
    
    .time {
      font-weight: 700;
      color: var(--accent);
      text-shadow: 0 0 10px var(--accent-glow);
      font-size: 16px;
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    @keyframes glow {
      from { text-shadow: 0 0 10px var(--accent-glow); }
      to { text-shadow: 0 0 20px var(--accent-glow), 0 0 30px var(--accent-glow); }
    }
    
    .mesh {
      font-size: 11px;
      padding: 4px 12px;
      border-radius: 15px;
      border: 1px solid var(--accent);
      background: linear-gradient(135deg, var(--accent-glow), rgba(255, 255, 255, 0.05));
      color: var(--accent);
      box-shadow: var(--shadow-glow);
      animation: pulse 2s ease-in-out infinite;
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: var(--shadow-glow); }
      50% { box-shadow: 0 0 60px var(--accent-glow); }
    }
    
    .toolbar {
      position: absolute;
      top: calc(var(--status-h) + var(--safe-top) + 8px);
      left: 12px;
      right: 12px;
      height: var(--editbar-h);
      display: none;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(10, 30, 15, 0.95), var(--accent-glow));
      border: 1px solid var(--accent);
      backdrop-filter: blur(20px);
      z-index: 999;
      box-shadow: var(--shadow-glow);
      transform: translateY(-10px);
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .toolbar.show {
      display: flex;
      transform: translateY(0);
      opacity: 1;
    }
    
    .btn {
      background: linear-gradient(135deg, rgba(26, 59, 26, 0.9), var(--accent-glow));
      border: 1px solid var(--accent);
      color: #cbffd9;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    .btn:hover {
      background: linear-gradient(135deg, var(--accent-light), var(--accent-glow));
      box-shadow: 0 8px 25px var(--accent-glow);
      transform: translateY(-2px);
    }
    
    .btn:hover::before {
      transform: translateX(100%);
    }
    
    .btn:disabled {
      background: linear-gradient(135deg, rgba(26, 59, 26, 0.5), rgba(0, 0, 0, 0.5));
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
    }
    
    .home {
      position: absolute;
      inset: calc(var(--status-h) + var(--safe-top) + var(--editbar-h) + 16px) 0 var(--dock-h) 0;
      overflow: hidden;
      z-index: 1;
    }
    
    .grid {
      height: 100%;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 18px;
      overflow-y: auto;
      overflow-x: hidden;
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch;
      grid-auto-rows: min-content;
    }
    
    .grid::-webkit-scrollbar {
      width: 6px;
    }
    
    .grid::-webkit-scrollbar-track {
      background: var(--accent-glow);
      border-radius: 3px;
    }
    
    .grid::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, var(--accent), var(--accent-dark));
      border-radius: 3px;
      box-shadow: 0 0 10px var(--accent-glow);
    }
    
    .grid::-webkit-scrollbar-thumb:hover {
      background: var(--accent);
      box-shadow: 0 0 15px var(--accent-glow);
    }
    
    .tile {
      aspect-ratio: 1/1;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      background: linear-gradient(145deg, var(--glass), var(--accent-glow));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      user-select: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(15px);
      overflow: hidden;
      min-height: 0;
      flex-shrink: 0;
    }
    
    .tile::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.05), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }
    
    .tile:hover {
      transform: translateY(-8px) scale(1.05);
      background: linear-gradient(145deg, var(--accent-glow), rgba(255, 255, 255, 0.05));
      border-color: var(--accent);
      box-shadow: 0 20px 40px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }
    
    .tile:hover::before {
      transform: translateX(100%);
    }
    
    .icon {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(236, 236, 236, 0.8));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      margin-bottom: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .icon::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transform: translateX(-100%);
      transition: transform 0.4s ease;
    }
    
    .tile:hover .icon {
      transform: scale(1.1) rotate(5deg);
      box-shadow: 0 12px 30px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    .tile:hover .icon::before {
      transform: translateX(100%);
    }
    
    .name {
      font-weight: 700;
      text-align: center;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.9);
      transition: color 0.3s ease;
    }
    
    .tile:hover .name {
      color: var(--accent);
      text-shadow: 0 0 10px var(--accent-glow);
    }
    
    .handle {
      position: absolute;
      right: 8px;
      bottom: 8px;
      width: 24px;
      height: 12px;
      border-radius: 8px;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent-dark) 30%, var(--accent) 60%, var(--accent-dark) 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
      animation: handleGlow 2s ease-in-out infinite;
    }
    
    @keyframes handleGlow {
      0%, 100% { box-shadow: 0 0 10px var(--accent-glow); }
      50% { box-shadow: 0 0 20px var(--accent-glow); }
    }
    
    .edit .handle {
      opacity: 1;
    }
    
    .jiggle {
      animation: jig 0.4s ease-in-out infinite, tileGlow 2s ease-in-out infinite;
    }
    
    @keyframes jig {
      0% { transform: rotate(-3deg) scale(1.02); }
      25% { transform: rotate(2deg) scale(1.02); }
      50% { transform: rotate(-2deg) scale(1.02); }
      75% { transform: rotate(3deg) scale(1.02); }
      100% { transform: rotate(-3deg) scale(1.02); }
    }
    
    @keyframes tileGlow {
      0%, 100% { box-shadow: 0 0 20px var(--accent-glow); }
      50% { box-shadow: 0 0 40px var(--accent-glow); }
    }
    
    .ghost {
      position: fixed;
      pointer-events: none;
      z-index: 9999;
      transform: scale(1.15) rotate(5deg);
      box-shadow: 0 25px 50px var(--accent-glow);
      border: 2px solid var(--accent);
    }
    
    .placeholder {
      outline: 3px dashed var(--accent);
      border-radius: 20px;
      background: var(--accent-glow);
      animation: placeholderPulse 1s ease-in-out infinite;
    }
    
    @keyframes placeholderPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 0.8; }
    }
    
    .dock {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      height: var(--dock-h);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 12px 20px calc(12px + var(--safe-bottom));
      background: linear-gradient(135deg, rgba(0, 0, 0, 0.85), var(--accent-glow));
      backdrop-filter: blur(25px);
      border-top: 1px solid var(--accent-glow);
      z-index: 1000;
    }
    
    .dock .d {
      width: 60px;
      height: 60px;
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      cursor: pointer;
      background: linear-gradient(135deg, var(--accent-light), var(--accent-dark));
      box-shadow: 0 10px 25px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.3);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .dock .d::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      transition: transform 0.5s ease;
    }
    
    .dock .d:hover {
      transform: translateY(-5px) scale(1.1);
      box-shadow: 0 15px 35px var(--accent-glow), inset 0 1px 0 rgba(255, 255, 255, 0.4);
    }
    
    .dock .d:hover::before {
      transform: translateX(100%);
    }

    .dock-item {
      background: linear-gradient(135deg, rgba(26, 59, 26, 0.9), var(--accent-glow));
      color: #cbffd9;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .dock-item:hover {
      transform: translateY(-5px);
      background: linear-gradient(135deg, var(--accent-light), var(--accent-glow));
      box-shadow: 0 8px 25px var(--accent-glow);
    }

    .panel {
      position: absolute;
      width: calc(100% - 24px);
      height: calc(100% - var(--status-h) - var(--safe-top) - var(--dock-h) - var(--safe-bottom) - 16px);
      top: calc(var(--status-h) + var(--safe-top) + 8px);
      left: 12px;
      border-radius: 24px;
      border: 1px solid var(--accent);
      background: linear-gradient(145deg, rgba(12, 20, 15, 0.98), var(--accent-glow));
      backdrop-filter: blur(25px);
      display: none;
      flex-direction: column;
      overflow: auto;
      box-shadow: var(--shadow-glow);
      z-index: 1;
      resize: both;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .panel.active {
      display: flex;
      z-index: 10;
    }

    .p-head {
      background: linear-gradient(135deg, var(--accent-glow), transparent);
      padding: 10px;
      font-weight: bold;
      cursor: move;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }
    
    .p-head .app-title {
      font-weight: 800;
      color: var(--accent);
      font-size: 18px;
      text-shadow: 0 0 10px var(--accent-glow);
    }
    
    .p-head .app-actions {
      display: flex;
      gap: 12px;
    }
    
    .p-head .app-actions .btn {
      padding: 8px 14px;
      font-size: 13px;
    }
    
    .p-body {
      flex: 1;
      position: relative;
      background: rgba(0, 0, 0, 0.3);
      overflow: auto;
      padding: 20px;
    }
    
    .p-body iframe {
      position: relative;
      width: 100%;
      height: 100%;
      border: 0;
      background: #000;
      border-radius: 0 0 24px 24px;
    }
    
    .scroll-indicator {
      position: absolute;
      bottom: calc(var(--dock-h) + 20px);
      left: 50%;
      transform: translateX(-50%);
      color: var(--accent);
      font-size: 12px;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      text-align: center;
    }
    
    .scroll-indicator.show {
      opacity: 0.7;
      animation: bounce 2s infinite;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
      40% { transform: translateX(-50%) translateY(-10px); }
      60% { transform: translateX(-50%) translateY(-5px); }
    }
    
    .settings-panel {
      position: absolute;
      width: calc(100% - 24px);
      height: calc(100% - var(--status-h) - var(--safe-top) - var(--dock-h) - var(--safe-bottom) - 16px);
      top: calc(var(--status-h) + var(--safe-top) + 8px);
      left: 12px;
      border-radius: 24px;
      border: 1px solid var(--accent);
      background: linear-gradient(145deg, rgba(12, 20, 15, 0.98), var(--accent-glow));
      backdrop-filter: blur(25px);
      display: none;
      flex-direction: column;
      overflow: auto;
      box-shadow: var(--shadow-glow);
      z-index: 1;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .settings-panel.active {
      display: flex;
      z-index: 10;
    }
    
    .settings-body {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    
    .settings-body h2 {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 20px;
      text-shadow: 0 0 10px var(--accent-glow);
    }
    
    .color-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .color-swatch {
      width: 100%;
      aspect-ratio: 1/1;
      border-radius: 12px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    .color-swatch:hover {
      transform: scale(1.1);
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow: 0 8px 20px var(--accent-glow);
    }
    
    .color-picker-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }
    
    .color-picker-container label {
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
    }
    
    .color-picker-container input[type="color"] {
      width: 100%;
      height: 40px;
      border-radius: 8px;
      border: 1px solid var(--accent);
      cursor: pointer;
    }
    
    .reset-button {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.7), rgba(255, 0, 0, 0.3));
      border: 1px solid rgba(255, 0, 0, 0.8);
      color: #fff;
      padding: 8px 16px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      width: 100%;
      text-align: center;
    }
    
    .reset-button:hover {
      background: linear-gradient(135deg, rgba(255, 0, 0, 0.9), rgba(255, 0, 0, 0.5));
      box-shadow: 0 8px 25px rgba(255, 0, 0, 0.5);
      transform: translateY(-2px);
    }
    
    .reset-button::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transform: translateX(-100%);
      transition: transform 0.3s ease;
    }
    
    .reset-button:hover::before {
      transform: translateX(100%);
    }

    .sync-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .sync-status {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.9);
      text-align: center;
    }

    .sync-log {
      font-size: 12px;
      color: var(--muted);
      background: rgba(0, 0, 0, 0.3);
      padding: 12px;
      border-radius: 8px;
      max-height: 150px;
      overflow-y: auto;
    }
    
    @media (max-height: 700px) {
      .grid, .app-switcher-body, .settings-body { padding: 15px; gap: 12px; }
      .tile, .app-switcher-tile { border-radius: 16px; }
      .icon { width: 44px; height: 44px; font-size: 22px; margin-bottom: 8px; }
      .name, .app-switcher-tile .name { font-size: 12px; }
      .panel, .settings-panel { width: calc(100% - 24px); height: calc(100% - var(--status-h) - var(--safe-top) - var(--dock-h) - var(--safe-bottom) - 16px); }
      .color-grid { grid-template-columns: repeat(3, 1fr); gap: 12px; }
    }
  </style>
</head>
<body>
  <div class="bg-particles" id="particles"></div>
  
  <div class="phone" id="phone">
    <div class="status">
      <div class="time" id="time">11:04 PM</div>
      <div class="mesh" id="mesh">⬡3</div>
    </div>

    <div class="toolbar" id="toolbar">
      <div>✨ Edit Mode Active</div>
      <div>
        <button class="btn" id="sortAZ">A→Z Sort</button>
        <button class="btn" id="done">Complete</button>
      </div>
    </div>

    <main class="home" id="home">
      <div class="grid" id="grid"></div>
      <div class="scroll-indicator" id="scrollIndicator">↓ Scroll to see more Appdrops ↓</div>
    </main>

    <section class="app-switcher" id="appSwitcher">
      <div class="app-switcher-head">
        <div class="app-switcher-title">Open Apps</div>
        <div class="app-actions">
          <button class="btn" id="closeSwitcher">Close</button>
        </div>
      </div>
      <div class="app-switcher-body" id="appSwitcherBody">
        <div class="app-switcher-empty">No apps open. Launch an Appdrop to start.</div>
      </div>
    </section>

    <section class="settings-panel" id="settingsPanel">
      <div class="p-head" onmousedown="startDragPanel(event, this.parentElement)">
        <div class="app-title">Settings</div>
        <div class="app-actions">
          <button class="btn minimize">–</button>
          <button class="btn close">✕</button>
        </div>
      </div>
      <div class="settings-body">
        <h2>Theme Color</h2>
        <div class="color-grid" id="colorGrid">
          <div class="color-swatch" style="background: #00ff7f" data-color="#00ff7f"></div>
          <div class="color-swatch" style="background: #007bff" data-color="#007bff"></div>
          <div class="color-swatch" style="background: #ff073a" data-color="#ff073a"></div>
          <div class="color-swatch" style="background: #6f42c1" data-color="#6f42c1"></div>
          <div class="color-swatch" style="background: #fd7e14" data-color="#fd7e14"></div>
          <div class="color-swatch" style="background: #ffc107" data-color="#ffc107"></div>
          <div class="color-swatch" style="background: #ff85a2" data-color="#ff85a2"></div>
          <div class="color-swatch" style="background: #20c997" data-color="#20c997"></div>
        </div>
        <div class="color-picker-container">
          <label for="colorPicker">Custom Color</label>
          <input type="color" id="colorPicker" value="#00ff7f">
        </div>
        <button class="reset-button" id="resetColor">Reset to Default</button>
        <h2>AppDrop Sync</h2>
        <div class="sync-container">
          <button class="btn" id="syncAppDrops" disabled>Sync AppDrops</button>
          <div class="sync-status" id="syncStatus">Checking network...</div>
          <div class="sync-log" id="syncLog"></div>
        </div>
      </div>
    </section>

    <footer class="dock">
      <div class="d" title="Home" id="homeBtn">🏠</div>
      <div class="d" title="Communications" id="phoneBtn">📞</div>
      <div class="d" title="App Switcher" id="appSwitcherBtn">📱</div>
      <div class="d" title="Settings" id="settingsBtn">⚙️</div>
    </footer>
  </div>

  <script>
    let APPDROPS = [
      { id: 'atlas', name: 'Atlas', emoji: '🌍', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/atlas/index.html' },
      { id: 'aurora', name: 'Aurora', emoji: '🌌', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/aurora/index.html' },
      { id: 'bryce', name: 'Bryce Holograms', emoji: '😇', path: 'https://charlesmack.github.io/bryce/index.html' },
      { id: 'cameras', name: 'Camera Shop', emoji: '🎥🏪', path: 'https://charlesmack.github.io/camera-shop/index.html' },
      { id: 'charles5-m', name: 'Charles5 M', emoji: '🎬', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/charles5-m/index.html' },
      { id: 'charles5-p', name: 'Charles5 P', emoji: '📽️', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/charles5-p/index.html' },
      { id: 'charles5-s', name: 'Charles5 S', emoji: '🎥', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/charles5-s/index.html' },
      { id: 'charles5-sf', name: 'Charles5 SF', emoji: '🎞️', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/charles5-sf/index.html' },
      { id: 'charles5-w', name: 'Charles5 W', emoji: '📺', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/charles5-w/index.html' },
      { id: 'dev-editor', name: 'Dev Editor', emoji: '💻', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/dev-editor/index.html' },
      { id: 'dj-drop', name: 'DJ Drop', emoji: '🎧', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/dj-drop/index.html' },
      { id: 'encyclopedia', name: 'Encyclopedia', emoji: '📚', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/encyclopedia/index.html' },
      { id: 'first-aid-quickref', name: 'First Aid QuickRef', emoji: '🩺', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/first-aid-quickref/index.html' },
      { id: 'firstaid', name: 'First Aid', emoji: '🚑', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/firstaid/index.html' },
      { id: 'fiveseconds-cine', name: 'FiveSeconds Cine', emoji: '🎬', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/fiveseconds-cine/index.html' },
      { id: 'fiveseconds-lite', name: 'FiveSeconds Lite', emoji: '🎥', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/fiveseconds-lite/index.html' },
      { id: 'hearsay-cinema', name: 'Hearsay Cinema', emoji: '🎭', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/hearsay-cinema/index.html' },
      { id: 'hearsay', name: 'Hearsay', emoji: '🗣️', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/hearsay/index.html' },
      { id: 'magifico-room', name: 'Magifico Room', emoji: '🏠', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/magifico-room/index.html' },
      { id: 'magifico-stage', name: 'Magifico Stage', emoji: '🎤', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/magifico-stage/index.html' },
      { id: 'mpc-drop', name: 'MPC Drop', emoji: '🎮', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/mpc-drop/index.html' },
      { id: 'Mini OS', name: 'OnePagerMiniOS', emoji: '💻', path: 'https://charlesmack.github.io/OnePagerMiniOS/index.html' },
      { id: 'planner-gemini', name: 'Planner Gemini', emoji: '📅', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/planner-gemini/index.html' },
      { id: 'planner-lite', name: 'Planner Lite', emoji: '🗓️', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/planner-lite/index.html' },
      { id: 'pops', name: 'POPS', emoji: '🌟', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/pops/index.html' },
      { id: 'retreat', name: 'Retreat', emoji: '🏕️', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/retreat/index.html' },
      { id: 'scratchpad', name: 'Scratchpad', emoji: '📝', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/scratchpad/index.html' },
      { id: 'strobe-hud', name: 'Strobe HUD', emoji: '💡', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/strobe-hud/index.html' },
      { id: 'strobe', name: 'Strobe', emoji: '✨', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/strobe/index.html' },
      { id: 'survivors-compass', name: 'Survivors Compass', emoji: '🧭', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/survivors-compass/index.html' },
      { id: 'tap-talk', name: 'Tap Talk', emoji: '💬', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/tap-talk/index.html' },
      { id: 'media-world', name: 'Media World', emoji: '🗺🕹', path: 'https://charlesmack.github.io/3d-media-player-world/index.html' },
      { id: 'viewria', name: 'Viewria', emoji: '👀', path: 'https://charlesmack.github.io/OnePagerMiniOS/appdrops/viewria/index.html' }
    ];

    // Initialize state
    let apps = [...APPDROPS];
    let openApps = [];
    let isEditMode = false;
    let draggedTile = null;
    let placeholder = null;
    let touchOffsetX = 0;
    let touchOffsetY = 0;
    let highestZ = 10;
    let isOnline = navigator.onLine;

    // DOM elements
    const phone = document.getElementById('phone');
    const grid = document.getElementById('grid');
    const toolbar = document.getElementById('toolbar');
    const sortAZ = document.getElementById('sortAZ');
    const done = document.getElementById('done');
    const homeBtn = document.getElementById('homeBtn');
    const appSwitcherBtn = document.getElementById('appSwitcherBtn');
    const appSwitcher = document.getElementById('appSwitcher');
    const appSwitcherBody = document.getElementById('appSwitcherBody');
    const closeSwitcher = document.getElementById('closeSwitcher');
    const scrollIndicator = document.getElementById('scrollIndicator');
    const timeElement = document.getElementById('time');
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsPanel = document.getElementById('settingsPanel');
    const colorPicker = document.getElementById('colorPicker');
    const resetColorBtn = document.getElementById('resetColor');
    const syncAppDropsBtn = document.getElementById('syncAppDrops');
    const syncStatus = document.getElementById('syncStatus');
    const syncLog = document.getElementById('syncLog');

    // Load saved AppDrops from localStorage
    function loadSavedAppDrops() {
      const savedApps = localStorage.getItem('appDrops');
      if (savedApps) {
        apps = JSON.parse(savedApps);
        APPDROPS = [...apps]; // Sync global APPDROPS with loaded apps
        renderTiles();
      }
    }

    // Save AppDrops to localStorage
    function saveAppDrops() {
      localStorage.setItem('appDrops', JSON.stringify(apps));
    }

    // Log sync messages
    function logSync(message) {
      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      const logEntry = document.createElement('div');
      logEntry.textContent = `[${time}] ${message}`;
      syncLog.appendChild(logEntry);
      syncLog.scrollTop = syncLog.scrollHeight;
    }

    // Update network status
    function updateNetworkStatus() {
      isOnline = navigator.onLine;
      syncAppDropsBtn.disabled = !isOnline;
      syncStatus.textContent = isOnline ? 'Online: Ready to sync' : 'Offline: Sync unavailable';
      mesh.textContent = isOnline ? '⬡3' : '⬡✕';
      if (isOnline) {
        logSync('Network connection re-established. Ready to sync AppDrops.');
      } else {
        logSync('Network connection lost. Sync disabled.');
      }
    }

    // Sync AppDrops with command center
    async function syncAppDrops() {
      if (!isOnline) {
        logSync('Cannot sync: No network connection.');
        syncStatus.textContent = 'Offline: Sync unavailable';
        return;
      }

      syncAppDropsBtn.disabled = true;
      syncStatus.textContent = 'Syncing...';
      logSync('Initiating AppDrop sync with command center...');

      try {
        const response = await fetch('https://charlesmack.github.io/command/appdrops/index.html');
        const html = await response.text();
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        const appDropLinks = doc.querySelectorAll('a[href*="/appdrops/"]');

        const remoteApps = Array.from(appDropLinks).map(link => {
          const path = link.href;
          const name = link.textContent.trim();
          const id = path.split('/').pop().replace('.html', '');
          return {
            id,
            name,
            emoji: '🌟', // Default emoji, as command center may not provide emojis
            path
          };
        });

        // Merge remote apps with local apps, avoiding duplicates
        const existingIds = new Set(apps.map(app => app.id));
        const newApps = remoteApps.filter(app => !existingIds.has(app.id));
        apps = [...apps, ...newApps];
        APPDROPS = [...apps]; // Update global APPDROPS
        saveAppDrops();
        renderTiles();

        logSync(`Sync complete: ${newApps.length} new AppDrops added.`);
        syncStatus.textContent = 'Sync complete';
        setTimeout(() => {
          syncStatus.textContent = 'Online: Ready to sync';
          syncAppDropsBtn.disabled = false;
        }, 2000);
      } catch (error) {
        logSync(`Sync failed: ${error.message}`);
        syncStatus.textContent = 'Sync failed';
        setTimeout(() => {
          syncStatus.textContent = 'Online: Ready to sync';
          syncAppDropsBtn.disabled = false;
        }, 2000);
      }
    }

    // Load saved color
    function loadSavedColor() {
      const savedColor = localStorage.getItem('themeColor') || '#00ff7f';
      updateThemeColor(savedColor);
      colorPicker.value = savedColor;
    }

    // Update theme color
    function updateThemeColor(hex) {
      const rgb = hexToRgb(hex);
      const lightRgb = adjustBrightness(rgb, 1.2);
      const darkRgb = adjustBrightness(rgb, 0.8);
      document.documentElement.style.setProperty('--accent', hex);
      document.documentElement.style.setProperty('--accent-light', `rgb(${lightRgb.r}, ${lightRgb.g}, ${lightRgb.b})`);
      document.documentElement.style.setProperty('--accent-dark', `rgb(${darkRgb.r}, ${darkRgb.g}, ${darkRgb.b})`);
      document.documentElement.style.setProperty('--accent-glow', `rgba(${rgb.r}, ${rgb.g}, ${rgb.b}, 0.3)`);
      localStorage.setItem('themeColor', hex);
    }

    // Convert hex to RGB
    function hexToRgb(hex) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return { r, g, b };
    }

    // Adjust RGB brightness
    function adjustBrightness({ r, g, b }, factor) {
      return {
        r: Math.min(255, Math.max(0, Math.round(r * factor))),
        g: Math.min(255, Math.max(0, Math.round(g * factor))),
        b: Math.min(255, Math.max(0, Math.round(b * factor)))
      };
    }

    // Reset to default color
    function resetToDefaultColor() {
      const defaultColor = '#00ff7f';
      updateThemeColor(defaultColor);
      colorPicker.value = defaultColor;
    }

    // Update time
    function updateTime() {
      const now = new Date();
      timeElement.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    setInterval(updateTime, 1000);
    updateTime();

    // Create particles
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animationDelay = `${Math.random() * 8}s`;
        particlesContainer.appendChild(particle);
      }
    }
    createParticles();

    // Render app tiles
    function renderTiles() {
      grid.innerHTML = '';
      apps.forEach(app => {
        const tile = document.createElement('div');
        tile.className = 'tile';
        tile.dataset.id = app.id;
        tile.innerHTML = `
          <div class="icon">${app.emoji}</div>
          <div class="name">${app.name}</div>
          <div class="handle"></div>
        `;
        tile.addEventListener('click', () => openApp(app));
        tile.addEventListener('touchstart', (e) => startDragTile(e, tile, app));
        tile.addEventListener('mousedown', (e) => startDragTile(e, tile, app));
        tile.addEventListener('contextmenu', (e) => {
          e.preventDefault();
          toggleEditMode();
        });
        grid.appendChild(tile);
      });
      checkScrollIndicator();
    }

    // Toggle edit mode
    function toggleEditMode() {
      isEditMode = !isEditMode;
      toolbar.classList.toggle('show', isEditMode);
      grid.querySelectorAll('.tile').forEach(tile => {
        tile.classList.toggle('edit', isEditMode);
        tile.classList.toggle('jiggle', isEditMode);
      });
    }

    // Sort apps A-Z
    sortAZ.addEventListener('click', () => {
      apps.sort((a, b) => a.name.localeCompare(b.name));
      saveAppDrops();
      renderTiles();
    });

    // Exit edit mode
    done.addEventListener('click', toggleEditMode);

    // Drag and drop tiles
    function startDragTile(e, tile, app) {
      if (!isEditMode) return;
      e.preventDefault();
      draggedTile = tile.cloneNode(true);
      draggedTile.classList.add('ghost');
      document.body.appendChild(draggedTile);
      
      const rect = tile.getBoundingClientRect();
      if (e.type === 'touchstart') {
        const touch = e.touches[0];
        touchOffsetX = touch.clientX - rect.left;
        touchOffsetY = touch.clientY - rect.top;
      } else {
        touchOffsetX = e.offsetX;
        touchOffsetY = e.offsetY;
      }
      
      placeholder = document.createElement('div');
      placeholder.className = 'placeholder';
      tile.parentNode.insertBefore(placeholder, tile.nextSibling);
      
      document.addEventListener('mousemove', moveDragTile);
      document.addEventListener('touchmove', moveDragTile);
      document.addEventListener('mouseup', endDragTile);
      document.addEventListener('touchend', endDragTile);
    }

    function moveDragTile(e) {
      if (!draggedTile) return;
      let clientX, clientY;
      if (e.type === 'touchmove') {
        clientX = e.touches[0].clientX;
        clientY = e.touches[0].clientY;
      } else {
        clientX = e.clientX;
        clientY = e.clientY;
      }
      
      draggedTile.style.left = `${clientX - touchOffsetX}px`;
      draggedTile.style.top = `${clientY - touchOffsetY}px`;
      
      const tiles = Array.from(grid.querySelectorAll('.tile'));
      const placeholderIndex = tiles.indexOf(placeholder);
      const target = document.elementFromPoint(clientX, clientY);
      const targetTile = target?.closest('.tile');
      
      if (targetTile && targetTile !== draggedTile) {
        const targetIndex = tiles.indexOf(targetTile);
        grid.insertBefore(placeholder, targetIndex < placeholderIndex ? targetTile : targetTile.nextSibling);
        
        const newOrder = tiles.filter(t => t !== draggedTile && t !== placeholder);
        const appId = draggedTile.dataset.id;
        const appIndex = apps.findIndex(a => a.id === appId);
        apps.splice(appIndex, 1);
        apps.splice(targetIndex, 0, APPDROPS.find(a => a.id === appId));
      }
    }

    function endDragTile() {
      if (draggedTile) {
        draggedTile.remove();
        placeholder.remove();
        draggedTile = null;
        placeholder = null;
        saveAppDrops();
        renderTiles();
      }
      document.removeEventListener('mousemove', moveDragTile);
      document.removeEventListener('touchmove', moveDragTile);
      document.removeEventListener('mouseup', endDragTile);
      document.removeEventListener('touchend', endDragTile);
    }

    // Drag panel
    function startDragPanel(e, panel) {
      e.preventDefault();
      bringToFront(panel);
      const rect = panel.getBoundingClientRect();
      const offsetX = e.clientX - rect.left;
      const offsetY = e.clientY - rect.top;

      function onMouseMove(e) {
        const phoneRect = phone.getBoundingClientRect();
        let newLeft = e.clientX - offsetX - phoneRect.left;
        let newTop = e.clientY - offsetY - phoneRect.top;
        newLeft = Math.max(0, Math.min(newLeft, phoneRect.width - panel.offsetWidth));
        newTop = Math.max(0, Math.min(newTop, phoneRect.height - panel.offsetHeight - (parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--dock-h')) + parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-bottom')))));
        panel.style.left = `${newLeft}px`;
        panel.style.top = `${newTop}px`;
      }

      function onMouseUp() {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
      }

      document.addEventListener('mousemove', onMouseMove);
      document.addEventListener('mouseup', onMouseUp);
    }

    // Bring panel to front
    function bringToFront(panel) {
      document.querySelectorAll('.panel, .settings-panel').forEach(p => p.classList.remove('active'));
      panel.style.zIndex = ++highestZ;
      panel.classList.add('active');
      home.style.display = 'none';
      appSwitcher.classList.remove('show');
    }

    // Open app
    function openApp(app) {
      if (isEditMode) return;
      let panel = document.querySelector(`.panel[data-id="${app.id}"]`);
      if (panel) {
        bringToFront(panel);
        panel.style.display = 'flex';
        return;
      }
      
      panel = document.createElement('div');
      panel.className = 'panel active';
      panel.dataset.id = app.id;
      panel.innerHTML = `
        <div class="p-head" onmousedown="startDragPanel(event, this.parentElement)">
          <div class="app-title">${app.name}</div>
          <div class="app-actions">
            <button class="btn minimize">–</button>
            <button class="btn new-tab">↗️</button>
            <button class="btn close">✕</button>
          </div>
        </div>
        <div class="p-body">
          <iframe src="${app.path}" sandbox="allow-scripts allow-same-origin allow-forms allow-popups"></iframe>
        </div>
      `;
      phone.appendChild(panel);
      openApps.push({ id: app.id, name: app.name, emoji: app.emoji, panel });
      
      const dockBtn = document.createElement('div');
      dockBtn.className = 'dock-item';
      dockBtn.textContent = app.emoji;
      dockBtn.title = app.name;
      dockBtn.onclick = () => {
        panel.style.display = 'flex';
        bringToFront(panel);
      };
      document.querySelector('.dock').appendChild(dockBtn);
      
      panel.querySelector('.minimize').addEventListener('click', () => {
        panel.style.display = 'none';
        if (!document.querySelector('.panel.active') && !settingsPanel.classList.contains('active')) {
          home.style.display = 'block';
        }
      });
      panel.querySelector('.new-tab').addEventListener('click', () => {
        window.open(app.path, '_blank');
      });
      panel.querySelector('.close').addEventListener('click', () => {
        panel.remove();
        dockBtn.remove();
        openApps = openApps.filter(a => a.id !== app.id);
        updateAppSwitcher();
        if (!document.querySelector('.panel.active') && !settingsPanel.classList.contains('active')) {
          home.style.display = 'block';
        }
      });
      panel.addEventListener('mousedown', () => bringToFront(panel));
      
      updateAppSwitcher();
      home.style.display = 'none';
    }

    // Open settings panel
    function openSettings() {
      bringToFront(settingsPanel);
      settingsPanel.style.display = 'flex';
      updateNetworkStatus();
    }

    // Settings panel event listeners
    settingsBtn.addEventListener('click', () => {
      openSettings();
    });

    settingsPanel.querySelector('.minimize').addEventListener('click', () => {
      settingsPanel.style.display = 'none';
      if (!document.querySelector('.panel.active')) {
        home.style.display = 'block';
      }
    });

    settingsPanel.querySelector('.close').addEventListener('click', () => {
      settingsPanel.style.display = 'none';
      if (!document.querySelector('.panel.active')) {
        home.style.display = 'block';
      }
    });

    // Color selection
    document.querySelectorAll('.color-swatch').forEach(swatch => {
      swatch.addEventListener('click', () => {
        const color = swatch.dataset.color;
        updateThemeColor(color);
        colorPicker.value = color;
      });
    });

    colorPicker.addEventListener('input', (e) => {
      updateThemeColor(e.target.value);
    });

    // Reset color
    resetColorBtn.addEventListener('click', () => {
      resetToDefaultColor();
    });

    // Sync button event listener
    syncAppDropsBtn.addEventListener('click', syncAppDrops);

    // Network status listeners
    window.addEventListener('online', updateNetworkStatus);
    window.addEventListener('offline', updateNetworkStatus);

    // Update app switcher
    function updateAppSwitcher() {
      appSwitcherBody.innerHTML = openApps.length === 0 
        ? '<div class="app-switcher-empty">No apps open. Launch an Appdrop to start.</div>'
        : '';
      
      openApps.forEach(app => {
        const tile = document.createElement('div');
        tile.className = 'app-switcher-tile';
        tile.dataset.id = app.id;
        tile.innerHTML = `
          <div class="name">${app.name}</div>
          <div class="icon">${app.emoji}</div>
          <div class="close-btn">✕</div>
        `;
        tile.addEventListener('click', () => {
          app.panel.style.display = 'flex';
          bringToFront(app.panel);
          appSwitcher.classList.remove('show');
          home.style.display = 'none';
        });
        tile.querySelector('.close-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          app.panel.remove();
          document.querySelector(`.dock-item[title="${app.name}"]`)?.remove();
          openApps = openApps.filter(a => a.id !== app.id);
          updateAppSwitcher();
          if (!document.querySelector('.panel.active') && !settingsPanel.classList.contains('active')) {
            home.style.display = 'block';
          }
        });
        appSwitcherBody.appendChild(tile);
      });
    }

    // Show/hide app switcher
    appSwitcherBtn.addEventListener('click', () => {
      appSwitcher.classList.toggle('show');
      home.style.display = appSwitcher.classList.contains('show') ? 'none' : (document.querySelector('.panel.active') || settingsPanel.classList.contains('active')) ? 'none' : 'block';
    });

    closeSwitcher.addEventListener('click', () => {
      appSwitcher.classList.remove('show');
      home.style.display = (document.querySelector('.panel.active') || settingsPanel.classList.contains('active')) ? 'none' : 'block';
    });

    // Go to home
    homeBtn.addEventListener('click', () => {
      appSwitcher.classList.remove('show');
      document.querySelectorAll('.panel, .settings-panel').forEach(p => {
        p.style.display = 'none';
      });
      home.style.display = 'block';
    });

    // Check scroll indicator
    function checkScrollIndicator() {
      const gridHeight = grid.scrollHeight;
      const containerHeight = grid.clientHeight;
      scrollIndicator.classList.toggle('show', gridHeight > containerHeight);
    }

    grid.addEventListener('scroll', checkScrollIndicator);
    window.addEventListener('resize', checkScrollIndicator);

    // Initialize
    loadSavedColor();
    loadSavedAppDrops();
    updateNetworkStatus();
  </script>
</body>
</html>
